<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>邀请有礼</title>
  <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="config.js"></script>
  <style type="text/css">
    * {
      margin: 0;
      padding: 0;
    }
    body {
      margin: 0;
      font-family: PingFangSC-Regular;
      font-size: 14px;
      color: #333;
      text-align: center;
    }
    .main {
      margin: auto;
      max-width: 680px;
    }
    img {
      display: block;
      width: 100%;
    }
    .dpr3 {
      display: none;
    }
    @media screen and (min-resolution: 3dppx) {
      .dpr2 {
        display: none;
      }
      .dpr3 {
        display: block;
      }
    }
    #head {
      position: relative;
    }
    #head .circle_frame {
      width: 25%;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      position: absolute;
      margin: auto;
      left: 0;
      right: 0;
      bottom: 9.7744%;
    }
    h5#user_name {
      font-family: PingFangSC-Medium;
      font-size: 16px;
      color: #333;
      letter-spacing: 0;
      margin-top: 2px;
    }
    span.bg {
      background-color: #ffef93;
    }
    span.fo {
      color: #e37d28;
      font-weight: bold;
    }
    .adver {
      width: 230px;
      margin: auto;
      line-height: 24px;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 36px;
      position: relative;
    }
    .adver:before {
      content: "";
      width: 28px;
      height: 28px;
      display: block;
      position: absolute;
      top: -1px;
      left: -29px;
      background: url("img/left@2x.png") no-repeat center/100%;
    }
    .adver:after {
      content: "";
      width: 28px;
      height: 28px;
      display: block;
      position: absolute;
      bottom: -1px;
      right: -29px;
      background: url("img/right@2x.png") no-repeat center/100%;
    }
    img.book {
      width: 150px;
      margin: 5px auto;
    }
    #phone_num {
      box-sizing: border-box;
      margin-top: 40px;
      margin-bottom: 20px;
      background: #f9f9f9;
      border: 1px solid #E5E5E5;
      width: 200px;
      height: 40px;
      padding: 10px;
      line-height: 20px;
      text-align: center;
    }
    #phone_num.alert {
      border-color: #e37d28;
    }
    #submit {
      width: 160px;
      margin: auto auto 8px;
      cursor: pointer;
    }
    .small {
      color: #999;
      font-size: 12px;
      line-height: 14px;
    }

  </style>
</head>

<body>
  <div class="main">
    <header id="head">
      <img class="dpr2" src="img/share_header_bg@2x.png" />
      <img class="dpr3" src="img/share_header_bg@3x.png" />
      <div id="user_img" class="circle_frame"></div>
    </header>
    <h5 id="user_name"></h5>
    <p class="adver">我在必胜公考学习<span id="user_study_days" class="fo"></span>天了
      <br/>这里有最新<span class="bg">真题练习</span>、精品<span class="bg">名师课程</span>、名师<span class="bg">在线答疑</span>。</p>
    <p>赠送你一本
      <br/>
      <img class="book dpr2" src="img/book@2x.png">
      <img class="book dpr3" src="img/book@3x.png">和我一起学习吧
      <br/> </p>
    <input id="phone_num" type="text" name="phone_num" placeholder="请输入手机号" autofocus maxlength="11" size="11" pattern="[0-9]">
    <div id="submit">
      <img class="submit dpr2" src="img/submit@2x.png">
      <img class="submit dpr3" src="img/submit@3x.png"> </div>
    <p class="small">点击立即领取后下载app
      <br/> 注册成功后在app内 <span class="fo">我的课程</span> 内领取</p>
  </div>
</body>
<script type="text/javascript">
  //等比例修改用户头像位置：
  $("#head .circle_frame").height($("#head .circle_frame").width());
  // 获取用户id
  window.user_id = getQueryString("user_id") || '';
  window.old_user_id = 0;
  newPage();
  function setOldUser(str){
    var str = str.toString();
    window.old_user_id = str;
  }

  // 创建页面：
  function newPage() {
    $.ajax({
      url: urls.share,
      type: 'get',
      data: {
        user_id: user_id,
        activity_id: urls.activity_id,
      },
      success: function(res) {
        if (res.code != 200) return false;
        $("#user_img").append('<img src="' + res.user.image_url + '">');
        $("#user_name").text(res.user.nickname);
        $("#user_study_days").text(res.user.study_days);
      },
    })
  }
  // 获取礼包：
  function collect(phone_num) {
    var is_new = 0;
    $.ajax({
      url: urls.collect,
      type: 'post',
      async: false,
      data: {
        user_id: window.user_id,
        activity_id: urls.activity_id,
        user_phone: phone_num
      },
      success: function(res) {
        if (res.code != 200) {
          alert("本次请求未成功，请检查您的网络状态！");
          return false;
        }
        alert(res.msg);
        setOldUser(res.old_user_id);
        is_new = res.is_new_user;
        return res.is_new_user;
      }
    })
    return is_new;
  }
  // 点击立即领取：
  $("#submit").on("click", function(e) {
    stopDefault(e);
    var reg = new RegExp('^1([0-9]{10})$');
    if (!$("#phone_num").val().match(reg)) {
      $("#phone_num").addClass('alert');
      return false;
    }else {
      $("#phone_num").removeClass('alert');
    }
    // 新用户
    var t=collect($("#phone_num").val());
    if (t) {
      window.location.href = "http://a.app.qq.com/o/simple.jsp?pkgname=gwy.winlesson.app"; // 两用app下载链接
    }
    // 老用户
    else {
      window.location.href = "./?user_id=" + old_user_id;
    }
  })

</script>

</html>
