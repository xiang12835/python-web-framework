<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="format-detection" content="telephone=no">
		<meta name="screen-orientation" content="portrait">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta name="Keywords" content="必胜公考">
		<meta name="Description" content="必胜公考·公考全程服务平台">
		<title>必胜公考登录</title>
		<link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="css/login.css" />
	</head>

	<body id="LoginForm">

		<div class="container">
			<div class="login-form">
				<div class="main-div">
					<div class="panel">
						<h2>必胜公考</h2>
					</div>
					<form id="Login">
						<div class="form-group">
							<input type="text" class="form-control" id="username" placeholder="手机号">
						</div>
						<div class="form-group flex">
							<input type="text" class="form-control wb60" id="verify_code" placeholder="验证码">
							<button type="button" class="btn btn-primary wb40" id="getyzm">获取验证码</button>
						</div>
						<button type="button" class="btn btn-primary mt10" onclick="btnlogin()">登录</button>
					</form>
				</div>

			</div>
		</div>

		<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery-ui.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/ms.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function getCookie(name) {
				var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");　　
				return(arr = document.cookie.match(reg)) ? unescape(arr[2]) : null;
			}

			function setCookie(name, value, Days) {
				var exp = new Date();
				exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
				document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + "; path=/";
			}

			window.onload = function() {
				
				var user_id = getCookie('user_id');
				if(user_id) {
					//判断有没有实名认证
					isCertification();
				}

				var timer = null;
				$("#getyzm").click(function() {
					var name = $("#username").val();
					if(name == '') {
						alert('请输入手机号');
						return false;
					} else {
						//判断是不是11位数字
						var re = /^1\d{10}$/; //正则表达式
						if(re.test(name)) { //判断字符是否是11位数字
							//stsmioow(name);  获取验证码————————这是真的上线前记得改回来
							var secrect = '69b81504767483cf';
							$.ajax({
								url: "https://api.web.platform.winlesson.com/user/get/phone/test/verify_code?username=" + name + "&from=web&secrect=" + secrect,
								type: "post",
								dataType: 'json',
								success: function(data) {
									console.log(data);
									if(data.code == 200) {
										$("#verify_code").val(data.verifyCode);
									}
								}
							});

							clearInterval(timer); //这句话至关重要
							var time = 60;
							var that = this;
							timer = setInterval(function() {
								if(time <= 0) {
									that.innerText = "";
									that.innerText = "重新发送";
									that.disabled = false;
									clearInterval(timer); //这句话至关重要
								} else {
									that.disabled = true;
									that.innerText = "";
									that.innerText = time + "秒";
									time--;
								}
							}, 1000);
						} else {
							alert("请输入正确的手机号");
						}
					}
				});
			}

			
			//登录
			function btnlogin() {
				var username = $("#username").val();
				var verify_code = $("#verify_code").val();

				if(username == '') {
					alert('请输入手机号');
					return false;
				}
				if(verify_code == '') {
					alert('请输入验证码');
					return false;
				}
				var url = 'https://api.web.platform.winlesson.com/api/user/v5/login/by_verify_code' + "?username=" + username + "&verify_code=" + verify_code + "&from=web"
				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					success: function(data) {
						setCookie('user_id', data.result.userinfo.user_id, 518400);
						//判断有没有实名认证
						isCertification();
					}
				});
			}

			//判断有没有实名认证
			function isCertification() {
				var user_id = getCookie('user_id');
				var url = 'https://api.web.platform.winlesson.com/api/live/gzh/h5/withdraw/is_authentication?user_id='+user_id;
				$.ajax({
					type: "get",
					url: url,
					dataType: "json",
					success: function(res) {
						if(res.code = '200') {
							if(res.data.is_authentication) {
								//实名认证直接看提现页 
								window.location.href = "page/main.html";
							} else {
								//没有实名认证先认证
								window.location.href = "page/index.html";
							}
						}

					}
				});
			}
		</script>
	</body>

</html>