<html>

	<head lang="zh-CN">
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="format-detection" content="telephone=no">
		<meta name="screen-orientation" content="portrait">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta name="Keywords" content="必胜公考">
		<meta name="Description" content="必胜公考·公考全程服务平台">
		<title>实名认证</title>
		<link rel="stylesheet" type="text/css" href="../css/base.css" />
		<link rel="stylesheet" type="text/css" href="../css/index.css" />
	</head>

	<body>
		<div id="attestation">
			<div class="wrap">
				<div class="form-item"><input type="text" name="realname" id="realname" placeholder="请输入真实姓名" value=""></div>
				<div class="form-item"><input type="text" name="idcard" id="idcard" placeholder="请输入身份证号"></div>
				<div id="fzm" class="upload-img"><q class="input-file-btn"><img id="zmimg" src="" class="imgShow"> <label for="cardhand" class="icon-upload"></label> <span class="des">上传手持身份证</span> <input type="file" id="cardhand" single="" accept="image/*" multiple class="uploadFile"  onchange="tirggerFile(event,1)"></q></div> <strong class="exampleTitle">示例：</strong>
				<div class="example clearfix"><img src="http://h.huajiao.com/dealwith/img/cardPic.png">
					<ol>
						<li>拍摄清晰的本人身份证正面照(照片不超过20M)</li>
						<li>请确保手持的身份证与填写的身份证信息一致</li>
					</ol>
				</div>
				<div id="fbm" class="upload-img"><q class="input-file-btn"><img id="fmimg" src="" class="imgShow"> <label for="cardback" class="icon-upload"></label> <span class="des">上传身份证背面</span> <input type="file" id="cardback" single="" accept="image/*" multiple class="uploadFile" onchange="tirggerFile(event,0)"></q></div> <strong class="exampleTitle">示例：</strong>
				<div class="example clearfix"><img src="http://h.huajiao.com/dealwith/img/cardback.jpg">
					<ol>
						<li>身份证背面需清晰拍摄有效期限位置(照片不超过20M)</li>
						<li>身份证有效期需一个月以上</li>
					</ol>
				</div>
				<a href="javascript:void(0);" class="btn btn-next btn-grey" id="subimg">提交
				</a>
				<div id="deal" class="deal"><label><span class="icon-check"></span>我已阅读并同意</label>
					<a href="http://mobile.winlesson.com/about/responsible">《必胜公考用户协议》</a>
				</div>
				<div class="serviceMsg">
					下载必胜公考app，获取更多提现金额
				</div>
			</div>




			<script src="../js/vue.js" type="text/javascript" charset="utf-8"></script>
			<script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
			<script src="../js/uploadimg.js" type="text/javascript" charset="utf-8"></script>
			<script src="../js/jweixin-1.2.0.js" type="text/javascript" charset="utf-8"></script>
			<script type="text/javascript">
				
				
			function tirggerFile(event,dd){
	            var that=this;
	            console.log(event);
	            var file = event.target.files[0];
	            if (!/image\/\w+/.test(file.type)) {
	                //alert("请确保文件为图像类型");
	                return false;
	            }
	
	            var formData = new FormData();
	            formData.append('image',file);
	            console.log(formData.get("image"));
	
	            $.ajax({
	              url: 'https://api.web.platform.winlesson.com/t/upload/image',  
	              type: 'POST',
	              data: formData,
	              cache: false,
	              contentType: false,
	              processData: false,
	              success: function (data) {
	              	 	console.log(data);
	              		if (dd==1) {//正面
	              			$("#zmimg").attr('src',data.url);
	              			$("#fzm .icon-upload").css('opacity',0);
	              			$("#fzm .des").css('opacity',0);
	              		} else{
	              			$("#fmimg").attr('src',data.url);
	              			$("#fbm .icon-upload").css('opacity',0);
	              			$("#fbm .des").css('opacity',0);
	              		}           
	              },  
	              error: function (data) {  
	                  console.log(data);  
	              },  
	              
	          });        
	      }
			
			$("#subimg").on('click',function(){
				var user_id = getCookie('user_id');
				var realname=$("#realname").val();
				var idcard=$("#idcard").val();
				var zmimg=$("#zmimg").val();
				var fmimg=$("#fmimg").val();
				if(realname == '') {
					alert('请输入真实姓名');
					return false;
				}
				if(idcard == '') {
					alert('请输入身份证号');
					return false;
				}
				if(zmimg == '') {
					alert('请上传手持身份证');
					return false;
				}
				if(fmimg == '') {
					alert('请上传背面身份证');
					return false;
				}
				var url = 'https://api.web.platform.winlesson.com/api/user/v5/login/by_verify_code' + "?user_truth_name=" + realname + "&identity_card_number=" + idcard + "&identity_card_front=" + zmimg + "&identity_card_behind=" + fmimg + "&user_id=" + user_id;
				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					success: function(data) {
						if(data.code==200){
							window.location.href='main.html';
						}else{
							alert(data.msg);
						}
					}
				});
				
			})
	</script>
	</body>

</html>