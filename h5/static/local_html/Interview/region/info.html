<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<link href="../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/main.css" />
		<script src="/static/js/jquery-1.11.3.min.js"></script>
		<script src="../js/handlebars-v4.0.11.js" type="text/javascript" charset="utf-8"></script>


		<script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?ee4433ce841f7d9c97fbc65c7ec66146";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    	</script>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-row mui-bar-footer-secondary pt5">
				<a class="mui-icon mui-icon-left-nav mui-pull-left back" href="region.html"></a>
				<button type="button" id="btnup" class="mui-btn mui-btn-warning fleft">首题</button>
				<button type="button" id="btnext" class="mui-btn mui-btn-warning fright"><i class="mui-icon mui-icon-forward"></i></button>
				<button type="button" id="btlast" class="mui-btn mui-btn-warning fright"><i class="mui-icon mui-icon mui-icon-back"></i></button>
			</div>

			<input type="hidden" id="myfromid" value="0"></input>
			<div id="content">
			   <!--handlebars填充-->
			</div>

			<script id="hdb_info" type="text/x-handlebars-template">
				{{#each datas}}
				<div class="mui-card">
					<div class="mui-row">
						<h4 class="center"> {{subject_type_name}}</h4>
					</div>
					
					<h4>题干</h4>
					<div class="pcolor">
						{{{review_title}}}
					</div>
					<div class="center">
						<input type="button" id="btntimelook" value="查看答案" onclick="btnlook()" />
					</div>
					<div class="hide pcolor" id="review_answer">
						{{{review_answer}}}
					</div>
				{{/each}}
			</script>
	    </div>
			<script src="../js/mui.min.js"></script>
			<script type="text/javascript">
				mui.init()

				function loadinfo(fid, _forward) {
			
				    var type= window.location.search.substr(1).split("&")[0].split("=")[0]; //类型：部门、地区
			        var did =window.location.search.substr(1).split("&")[1].split("=")[0];  //id
					
					var exam_type_id='';
				    var department_id='';
				    
				    if (type=='dept') {//国考部门
				    	   department_id=did;
				    } else{        //地区
				      	exam_type_id=did;
				    }
//				    console.log(type);
//				    console.log("地区" +exam_type_id);
//					console.log("部门" +department_id);
					
					
					var _fid = window.localStorage[did];
					
					
                    // console.log(did);
					console.log(fid + "," + _fid);
					//读取最后一次阅读的历史题目
					if(typeof(_fid) != "undefined") {
						if(_fid) {
							fid = _fid;
						}
					}

					if(did) {
						$.ajax({
							dataType: "json",
							type: "GET",
							data: {
								'exam_type_id': exam_type_id,   //地区
								'department_id': department_id, //部门
								'fromid': fid,
								'page_count': 1,
								'forward': _forward
							},
							url: "https://api.msg.platform.winlesson.com/api/area/review/subject/info",
							success: function(data) {
								//console.log(data);
								if(data.code == 200) {
									//当前id
									$("#myfromid").val(data.datas[0].id);

								    //注册一个Handlebars模版，通过id找到某一个模版，获取模版的html框架
									var template = Handlebars.compile($("#hdb_info").html());
									//模板加载
									$("#content").html(template(data));

									//save read position
									window.localStorage[did] = fid;
									
									
								} else {
									alert(data.msg);
								};

							},
							error: function(error) {
								//异常处理；
							
						        $("#content").html("<div class='mui-row'><div class='center'>正在努力更新中~</div></div>");

								console.log(error);
							}
						});

					}
					
				};

				//var countdown = 60;
				//var tt;

				$(function() {
					loadinfo(0);
				})
				//			下一题
				$("#btnext").on("click", function() {
					window.localStorage.clear();
					var fid = $("#myfromid").val();
					loadinfo(fid, 1);
				})
				$("#btlast").on("click", function() {
					window.localStorage.clear();
					var fid = $("#myfromid").val();
					loadinfo(fid, 0);
					
				})

				//			第一条
				$("#btnup").on("click", function() {
					window.localStorage.clear();
					loadinfo(0, 1);
				
				})

				//查看答案
				function btnlook() {
					$("#review_answer").removeClass('hide');
				}
			</script>
	</body>

</html>