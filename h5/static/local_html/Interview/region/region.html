<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<link href="../css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/index.css" />
		<script src="/static/js/jquery-1.11.3.min.js"></script>
		<script src="../js/handlebars-v4.0.11.js" type="text/javascript" charset="utf-8"></script>
		<style>
			.mui-bar{background-color: #fff}
			
			
			.fr {float: right;}
			
			.m5 {margin: 5px;}
			
		
			#hdb_stadiv{font-size: 16px;}
			
			.mui-table-view-cell.mui-active {
    				background-color: #fff !important;
			}
			.ggactive{
				color: #fcb200;
			}
		</style>


		 <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?ee4433ce841f7d9c97fbc65c7ec66146";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    	</script>
	</head>

	<body>
		 <header class="mui-bar mui-bar-nav">
			<button type="button" id="btnstar" class="mui-btn mui-btn-warning fr m5">开始练习</button>
			<a type="button" id="btnregion" class="mui-btn mui-btn-warning fr m5" href="../index.html">专项练习</a>
		</header>
		<div class="mui-content">
			
			<!--<div class="mui-row mui-bar-footer-secondary">
				<button type="button" id="btnstar" class="mui-btn mui-btn-warning fr m5">开始练习</button>
				<a type="button" id="btnregion" class="mui-btn mui-btn-warning fr m5" href="../index.html">专项练习</a>
			</div>-->
			<div class="mui-row mui-bar-footer-secondary">
				<div id="hdb_stadiv" class="somepart">

				</div>
			</div>

			<script id="hdb_staul" type="text/x-handlebars-template">
				<ul id="regionlist" class="mui-table-view">
					{{#each result}}
						{{#ifgk departments}}
						<li class="mui-table-view-cell mui-collapse">
							<a class="mui-navigate-right" href="#">{{type_name}}</a>
							{{#each departments}}
							<div class="mui-collapse-content">
								<p data-vid="{{id}}" data-type="dept">{{title}}</p>
							</div>
							{{/each}}
						</li>
						{{else}}
						<li class="mui-table-view-cell" data-vid="{{exam_type_id}}" data-type="city">
							{{type_name}}
						</li>
						{{/ifgk}} 
					{{/each}}
				</ul>
			</script>

		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init()
			$(function() {
				$.ajax({
					dataType: "json",
					type: "GET",
					url: "https://api.msg.platform.winlesson.com/api/review_subject/exam_type_list?guid=9c553730ef5b6c8c542bfd31b5e25b69&doc=1",
					success: function(data) {
						console.log(data);
						if(data.code == 200) {
							//判断是不是有子
							Handlebars.registerHelper("ifgk", function(value, options) {
								if(value) {
									return options.fn(this);
								} else {
									return options.inverse(this);
								}
							});

							//注册一个Handlebars模版，通过id找到某一个模版，获取模版的html框架
							var template = Handlebars.compile($("#hdb_staul").html());
							//模板加载
							$("#hdb_stadiv").html(template(data));
							
							//点击li
							$(".mui-table-view").on('click', '.mui-table-view-cell', function() {	
								  //如果不是国考，加选中的class
								 if ($(this).children('.mui-collapse-content').length<=0) {
								 	    $('.liactive').removeClass('liactive');
								        $(this).addClass('liactive');
								 }								 
							})
							
							//国考下部门选中
							$(".mui-collapse-content").on('click', function() {
								$('.liactive').removeClass('liactive');
								$(this).children().addClass('liactive');
							})
						};
					},
					error: function(error) {
						//异常处理；
						console.log(error);
					}

				});
			});
			
			$("#btnstar").on("click", function() {
				var did = $('.liactive').attr('data-vid'); 
				var type = $('.liactive').attr('data-type');  
				if(did) {
					window.location.href = "info.html?"+type+"&" + did.toString();				
				} 
			})
		</script>
	</body>

</html>