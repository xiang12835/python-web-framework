<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="content-security-policy">
		<link href="css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/main.css"/>
		<script src="/static/js/jquery-1.11.3.min.js"></script>
		<script src="js/handlebars-v4.0.11.js" type="text/javascript" charset="utf-8"></script>

		<script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?ee4433ce841f7d9c97fbc65c7ec66146";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    	</script>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-row mui-bar-footer-secondary pt5">
				<a class="mui-icon mui-icon-left-nav mui-pull-left back" href="index.html"></a>
				<button type="button" id="btnup" class="mui-btn mui-btn-warning fleft">首题</button>
				<button type="button" id="btnext" class="mui-btn mui-btn-warning fright"><i class="mui-icon mui-icon-forward"></i></button>
				<button type="button" id="btlast" class="mui-btn mui-btn-warning fright"><i class="mui-icon mui-icon mui-icon-back"></i></button>
			</div>

			<input type="hidden" id="myfromid" value="0"></input>
			<input type="hidden" id="last_id" value="0"></input>
			<div id="content">  
              
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init()

			function loadinfo(fid, _forward) {
				//$("#upfromid").html(upid);
				var html = [];
				var content = document.getElementById("content");
				var did = window.location.search.substring(1);
				var _fid = window.localStorage[did];

				console.log(fid + "," + _fid);
				//读取最后一次阅读的历史题目
				if(typeof(_fid) != "undefined") {
					if(_fid) {
						fid = _fid;
					}
				}

				if(did) {
					$.ajax({
						dataType: "json",
						type: "GET",
						data: {
							'subject_type_id': did,
							'fromid': fid,
							'page_count': 1,
							'forward': _forward
						},
						url: "https://api.msg.platform.winlesson.com/api/review/subject/info",
						success: function(data) {
							console.log(data);
							if(data.code == 200) {
                                //当前id
								$("#myfromid").val(data.datas[0].id);
														
								console.log(data.datas[0].id);
								for(i = 0; i < data.datas.length; i++) {
									html.push('<div class="mui-card"><div class=""><h4>题干</h4>' + data.datas[i].review_title + '</div><div class="center"><input type="button" id="btntimelook" value="查看答案"  onclick="btnlook()" /></div><div class="hide" id="review_answer">' + data.datas[i].review_answer + '</div></div>');
								}
								content.innerHTML = html.join('');
								$("#last_id").val(data.last_id);
								
								//save read position
								window.localStorage[did] = fid;
							} else {
								alert(data.msg);
							};

						},
						error: function(error) {
							//异常处理；
							console.log(error);
						}

						//document.getElementById('down').classList.add('mui-active');
					});

				}
			};
			
			//var countdown = 60;
			//var tt;
			
			$(function() {
				loadinfo(0);
				//页面加载自动触发事件
//				setTimeout(function() {
//					count_down();
//				}, 500);
			})
			//			下一题
			$("#btnext").on("click", function() {
				window.localStorage.clear();
				var fid = $("#myfromid").val();
				loadinfo(fid, 1);
				//count_down();
			})
			$("#btlast").on("click", function() {
				window.localStorage.clear();
				var fid = $("#myfromid").val();
				loadinfo(fid, 0);
				//count_down();
			})

			//			第一条
			$("#btnup").on("click", function() {
				window.localStorage.clear();
				loadinfo(0, 1);
				//count_down();
			})
   
			//倒计时
//			function count_down(){
//				if(tt){window.clearTimeout(tt);console.log("clear timout")}
//				countdown = 60;
//				settime();
//			}
//			
//			function settime() {
//				var val = $("#showlab");
//				if(countdown == 0) {
//					val.html("");
//					countdown = 0;
//					if(tt){window.clearTimeout(tt);}
//				} else {
//					val.html("(" + countdown + "s)");
//					countdown--;
//				}
//				tt = setTimeout(function() {
//					settime(val)
//				}, 1000)
//			}
			
			//查看答案
			function btnlook(){
				$("#review_answer").removeClass('hide');
				//var val = $("#btntimelook");
				//val.val("查看答案");
				//if(tt){window.clearTimeout(tt);console.log("clear timout")};
			}
		</script>
	</body>

</html>