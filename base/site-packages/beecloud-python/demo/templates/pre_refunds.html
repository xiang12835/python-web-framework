<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>预退款审核</title>
    <link type="text/css" rel="stylesheet" href="static/demo.css" />
    <script language="JavaScript" type="text/javascript" src="static/jquery-2.1.4.min.js"></script>

    <script type="text/javascript">
        function approve_pre_refunds() {
            var tmp="";
            $("input[type=checkbox]").each(function(){
                if(this.checked){
                    tmp += $(this).val();
                    tmp += "@";
                }
            });

            if (tmp.length > 1){
                tmp = tmp.substring(0, tmp.length - 1);
                window.open("/audit_pre_refunds?ids=" + tmp + '&channel=' + $('#channel').val());
            }
        }
    </script>
</head>
<body>
    <h3>注意：批量审核必须针对同一个渠道发起</h3>
    {% if pre_refunds|count %}<input type="hidden" id="channel" value="{{ pre_refunds[0].channel }}" />{% endif %}
    <table>
        <tr>
            <th>审核通过</th>
            <th>退款记录的唯一标识</th>
            <th>支付订单号</th>
            <th>支付渠道</th>
            <th>支付子渠道</th>
            <th>退款是否完成</th>
            <th>退款创建时间</th>
            <!-- <th>附加数据</th> -->
            <th>退款是否成功</th>
            <th>商品标题</th>
            <th>订单金额/分</th>
            <th>退款金额/分</th>
            <th>退款单号</th>
            <!-- <th>渠道详细信息</th> -->
        </tr>

        {% for refund in pre_refunds %}
        <tr {% if not loop.index%2 %} class="blue_bg" {% endif %}>
            <td><input name="approveCB" type="checkbox" value="{{ refund.id }}" /></td>
            <td>{{ refund.id }}</td>
            <td>{{ refund.bill_no }}</td>
            <td>{{ refund.channel }}</td>
            <td>{{ refund.sub_channel }}</td>
            <td>{{ refund.finish }}</td>
            <td>{{ refund.create_time | format_utc_time }}</td>
            <!-- <td>{{ refund.optional }}</td> -->
            <td>{{ refund.result  }}</td>
            <td>{{ refund.title }}</td>
            <td>{{ refund.total_fee }}</td>
            <td>{{ refund.refund_fee }}</td>
            <td>{{ refund.refund_no  }}</td>
            <!-- <td>{{ refund.message_detail }}</td> -->
        </tr>
        {% endfor %}

    </table>

    <input onclick="approve_pre_refunds()" type="button" class="button" value="同意预退款" />
    <div style="height: 50px"></div>
    <h3>注意：当channel为ALI时，如果退款成功，map中包含支付宝退款地址，需用户在支付宝平台上手动输入支付密码处理！</h3>
</body>
</html>