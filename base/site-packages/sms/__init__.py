#coding=utf-8
import datetime
import httplib, urllib

is_register_sms = False

def http_service(params, action):
    params = urllib.urlencode(params)

    headers = {"Content-type": "application/x-www-form-urlencoded",
               "Accept": "text/plain"}

    conn = httplib.HTTPConnection("sdkhttp.eucp.b2m.cn")
    try:
        conn.request("POST", action, params, headers)
        response = conn.getresponse()
        data = response.read()
        print data
        return data
    finally:
        conn.close()


def register_sms():
    params = {'cdkey': "0SDK-EMY-0130-LBZOT", 'password': "932177"}
    http_service(params, action="/sdkproxy/regist.action")


def send_sms(phone, message, cdkey="3SDK-EMY-0130-MGRML", password="436609", addserial="", log_model=None):
    params = {'cdkey': cdkey, 'password': password,\
              'phone': phone, "message": message, "addserial": addserial}

    return_msg = http_service(params, action="/sdkproxy/sendsms.action")

    if log_model:
        log_model(mobile=phone, return_msg=return_msg).save()


if __name__ == "__main__":
    send_sms("15810398104",
             message="你请求的手机验证码：123456，七日内有效，如果没有请求验证，请忽略此条短[微云游戏社区]")
