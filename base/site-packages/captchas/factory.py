from django.core.cache import cache
import pickle

class CacheFactory(object):
	
	def __init__(self, lifetime=60*15):
		self.lifetime = lifetime

	def new(self, cls, *args, **kwargs):
		inst = cls(*args, **kwargs)
		cache.set("captchas:%s" % inst.id, pickle.dumps(inst), self.lifetime)
		return inst

	def get(self, id):
		objstr = cache.get("captchas:%s" % id)
		if not objstr:
			return None
		else:
			return pickle.loads(objstr)

	def clean(self):
		pass

	def test(self, id, solutions):
		objstr = cache.get("captchas:%s" % id)
		if not objstr:
			return False
		else:
			inst = pickle.loads(objstr)
			return inst.testSolutions(solutions)